# demoWB ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

–ï–¥–∏–Ω–æ–µ Streamlit-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º Wildberries, Ozon –∏ SBIS. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–±—Ä–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª –∏ –±—ã—Å—Ç—Ä–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –∏ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö.

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì¶ **–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤** –Ω–∞ SQLAlchemy (Postgres/SQLite) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–º–ø–æ—Ä—Ç–æ–≤, —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–ª–æ–Ω–æ–∫.
- üîÑ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤**: –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è Ozon –∏ Wildberries, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —á–µ—Ä–µ–∑ Streamlit secrets.
- üìä **Data Workspace** ‚Äî —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ `product_items`.
- üóÇÔ∏è **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ `streamlit_app.py`**: –æ–±—â–∞—è —à–∞–ø–∫–∞, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ onboarding —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- üõ†Ô∏è **Alembic** –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π, –º–æ–¥—É–ª—å `db.py` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `DATABASE_URL` –∏ fallback –Ω–∞ `db.sqlite3`.
- ‚öôÔ∏è **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env` –∏ `.streamlit/secrets.toml`**, –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `python-dotenv`.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
/home/engine/project
‚îú‚îÄ‚îÄ streamlit_app.py            # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ onboarding
‚îú‚îÄ‚îÄ app_layout.py               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Streamlit, —à–∞–ø–∫–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ 1_Products.py           # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (SQLAlchemy)
‚îÇ   ‚îú‚îÄ‚îÄ 2_OZON_Products.py      # Ozon Seller API
‚îÇ   ‚îú‚îÄ‚îÄ WB_Products.py          # Wildberries API
‚îÇ   ‚îú‚îÄ‚îÄ SBIS_Products.py        # –ò–º–ø–æ—Ä—Ç –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ SBIS
‚îÇ   ‚îî‚îÄ‚îÄ Data_Workspace.py       # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ db.py                       # SQLAlchemy engine/session, –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic
‚îú‚îÄ‚îÄ models.py                   # –ú–æ–¥–µ–ª–∏ Product –∏ ProductImportLog
‚îú‚îÄ‚îÄ product_service.py          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
‚îú‚îÄ‚îÄ product_repository.py       # –•—Ä–∞–Ω–∏–ª–∏—â–µ `product_items` (SQLite)
‚îú‚îÄ‚îÄ alembic/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä—Å–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ .streamlit/
‚îÇ   ‚îú‚îÄ‚îÄ config.toml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Streamlit
‚îÇ   ‚îî‚îÄ‚îÄ secrets.toml.example    # –®–∞–±–ª–æ–Ω —Å–µ–∫—Ä–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Streamlit, SQLAlchemy, Alembic –∏ –¥—Ä.)
‚îî‚îÄ‚îÄ ...                         # –ö–ª–∏–µ–Ω—Ç—ã, —É—Ç–∏–ª–∏—Ç—ã, –º–æ–∫-–¥–∞–Ω–Ω—ã–µ
```

## –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º

- Python 3.10+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.11).
- –£—Ç–∏–ª–∏—Ç–∞ `alembic` –ø–æ–ø–∞–¥–∞–µ—Ç —á–µ—Ä–µ–∑ `requirements.txt`.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite-–±–∞–∑–∞ `db.sqlite3` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã products –∏ product_import_logs)
alembic upgrade head

# –ó–∞–ø—É—Å–∫ Streamlit-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (smoke-—Ç–µ—Å—Ç)
streamlit run streamlit_app.py
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é (–∫–Ω–æ–ø–∫–∏ –≤ —à–∞–ø–∫–µ) –∏–ª–∏ –ø–æ –ø—Ä—è–º—ã–º —Å—Å—ã–ª–∫–∞–º.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ `.env`

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Ñ–∞–π–ª–∞ `.env` (—á–µ—Ä–µ–∑ `python-dotenv`).

```bash
# .env
DATABASE_URL=postgresql+psycopg2://user:password@host:5432/marketplace
```

- –ï—Å–ª–∏ `DATABASE_URL` –Ω–µ –∑–∞–¥–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite (`db.sqlite3`).
- –î–ª—è PostgreSQL —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥—Ä–∞–π–≤–µ—Ä `psycopg2-binary` (–¥–æ–±–∞–≤–ª–µ–Ω –≤ `requirements.txt`).

### –°–µ–∫—Ä–µ—Ç—ã Streamlit

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.streamlit/secrets.toml`, –∏—Å–ø–æ–ª—å–∑—É—è —à–∞–±–ª–æ–Ω:

```toml
# .streamlit/secrets.toml
DATABASE_URL = "postgresql+psycopg2://user:password@host:5432/marketplace"
OZON_CLIENT_ID = "your_client_id"
OZON_API_KEY = "your_api_key"
WB_API_TOKEN = "your_wb_api_token"
```

> –≠—Ç–∏ –∫–ª—é—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü Ozon –∏ Wildberries. –í –æ–±–ª–∞–∫–µ (Streamlit Cloud, Render, Railway) –∑–∞–¥–∞–π—Ç–µ –∏—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –•—Ä–∞–Ω–∏–ª–∏—â–µ | –¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
|----------|------------|-----------|----------------------|
| `streamlit_app.py` | –û–Ω–±–æ—Ä–¥–∏–Ω–≥, —Å—Ç–∞—Ç—É—Å—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –±—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ | ‚Äî | ‚Äî |
| `pages/1_Products.py` | –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ —Å CRUD, –∏–º–ø–æ—Ä—Ç–æ–º/—ç–∫—Å–ø–æ—Ä—Ç–æ–º, –∂—É—Ä–Ω–∞–ª–æ–º | SQLAlchemy (`products`, `product_import_logs`) | `DATABASE_URL` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `pages/2_OZON_Products.py` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Ozon Seller API | `product_items` (SQLite) | `OZON_CLIENT_ID`, `OZON_API_KEY` |
| `pages/WB_Products.py` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ Wildberries | `product_items` (SQLite) | `WB_API_TOKEN` |
| `pages/SBIS_Products.py` | –ò–º–ø–æ—Ä—Ç –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ SBIS –∏–∑ —Ñ–∞–π–ª–æ–≤ | `product_items` (SQLite) | ‚Äî |
| `pages/Data_Workspace.py` | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–∞—Å—Å–æ–≤—ã–µ –ø—Ä–∞–≤–∫–∏ | `product_items` (SQLite) | ‚Äî |

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- –ú–æ–¥—É–ª—å `db.py` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `DATABASE_URL`, —Å–æ–∑–¥–∞—ë—Ç `engine` –∏ `SessionLocal`. –î–ª—è SQLite –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `db.sqlite3` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–∑—ã–≤–∞—é—Ç `init_db()`, –∫–æ—Ç–æ—Ä—ã–π –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å `alembic upgrade head` (—Å–º. –ø–∞–ø–∫—É `alembic/`). –ï—Å–ª–∏ Alembic –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Base.metadata.create_all()`.
- –î–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic:
  ```bash
  alembic revision -m "comment"
  alembic upgrade head
  alembic downgrade -1
  ```

## –ó–∞–ø—É—Å–∫ –≤ –æ–±–ª–∞–∫–µ

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (Streamlit Cloud, Render, Railway –∏ —Ç.–ø.).
2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è/—Å–µ–∫—Ä–µ—Ç—ã:
   - `DATABASE_URL` (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–Ω–µ—à–Ω—è—è –ë–î).
   - `OZON_CLIENT_ID`, `OZON_API_KEY`, `WB_API_TOKEN` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.
3. –£–∫–∞–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞: `streamlit run streamlit_app.py --server.port $PORT --server.headless true` (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã).
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `requirements.txt` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

## –ü–æ–ª–µ–∑–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

- `sync.py` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (WB mock) –≤ –∫–∞—Ç–∞–ª–æ–≥ SQLAlchemy.
- `sync_wb.py`, `sync_ozon.py` ‚Äî –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API.
- `data/` ‚Äî –æ–±—Ä–∞–∑—Ü—ã —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (CSV/XLSX).

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (Smoke-test)

```bash
streamlit run streamlit_app.py
```

–ö–æ–º–∞–Ω–¥–∞ –ø–æ–¥–Ω–∏–º–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å—Ç–∞—Ç—É—Å—ã –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –±—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

---
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–∞—á–Ω–∏—Ç–µ —Å —Ñ–∞–π–ª–∞ `streamlit_app.py`: –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞.
